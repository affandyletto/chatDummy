<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Interface</title>
     <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/1d0ae6bdcd.js" crossorigin="anonymous"></script>

    <!-- JQuery-->
    <script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
  crossorigin="anonymous"></script>

    <style>
        body {
            margin: 0;
            font-family:Google Sans, Helvetica Neue, sans-serif;
            background-color: #FFFFFF;
            display: flex;
            justify-content: center;
            height: 100vh;
            padding-top: 40px; /* Optional: Add some padding from the top if needed */
        }

        .logo-img {
            height: 300px;
            width: auto;  /* Ensure the width scales proportionally */
        }

        .container2 {
            display: flex;
            flex-direction: column;
            width: 90%;
            max-width: 850px;
            height: 90%;
            background-color: #FFFFFF;
            border: 1px solid rgba(0, 0, 0, 0.1); 
            border-radius: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .logo-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: #201638;
            /*background-color: #FFA500 */;
            border-top-left-radius: 0px;
            border-top-right-radius: 0px;
        }

        .chat-window {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .chat-bubble {
                
            background-color: #F0F3FF;
            border-radius: 0px;
            padding: 10px 20px;
            max-width: 70%;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            align-self: flex-end;
        }

        .chat-bubble p {
            margin: 0;
        }

        .chatbot-bubble {
            background-color: #DDF8D8;
            border-radius: 0px;
            padding: 10px 20px;
            max-width: 70%;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            align-self: flex-start;
        }

        .chatbot-bubble p {
            margin: 0;
        }

        .chat-input-container {
            display: flex;
            align-items: center;
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 5px;
            margin: 10px 20px;
            background-color: #fff;
        }

        .footer {
            padding: 5px;
            margin: 10px 20px;
        }

        .chat-input {
            border: none;
            padding: 10px 15px;
            font-size: 16px;
            outline: none;
            flex: 1;
            border-radius: 0px;
        }

        .chat-button {
            background-color: transparent;
            border: none;
            cursor: pointer;
            padding: 0 10px;
            display: flex;
            align-items: center;
        }

        .chat-button svg {
            height: 25px;
            width: 25px;
            fill: #FFA500; /* New icon color */
        }

        .update-button {
            border-radius: 0%;
            border: 1px solid white;
            background-color: #201638;
            color: white;
            padding: 5px 10px;
            font-size: 14px;
            cursor: pointer;
        }

        .toggle-container {
            display: flex;
            align-items: center;
        }

        .toggle-label {
            margin-left: 10px;
            font-size: 14px;
            font-family: 'Arial', sans-serif; /* Specify the desired font family */
            font-weight: bold; /* Change to "normal" if you don't want bold */
            color: white;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #B377F1;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
        }

        input:checked+.slider {
            background-color: #B377F1;
        }

        input:focus+.slider {
            box-shadow: 0 0 1px #2196F3;
        }

        input:checked+.slider:before {
            transform: translateX(26px);
        }

        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }
        .chatbot-source{
            font-size:11px; margin-top:-5px; font-weight:300; opacity:70%
        }

        .feedback-container {
            height:200px;
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 20px;
            background-color: #F9FAFE;
            display:none;
        }

        .selected-icon {
            background-color: #D3E3FC; /* Soft blue background */
            border-radius: 50%;        /* Rounded corners */
            padding: 10px;
        }

        .btn-selected {
            background-color: #6c757d; /* Bootstrap primary blue */
            color: white; /* White text */
            border-color: #5a6268; /* Border color same as background */
        }
    </style>
</head>

<body>

    <div class="container2">
        <div class="logo-container">
            <!--<img src="https://raw.githubusercontent.com/AsadCh3/cdn/main/nevolvis.png" class="logo-img">-->
            <img src="https://bucket-aja.s3.ap-southeast-1.amazonaws.com/images/nevbot2.png" class="logo-img" style="height:120px; position:absolute; left:45%; margin-bottom:-5px">
            
           
        </div>
        <div class="header">
            <button class="update-button" id="update-button">Update Chatbot</button>
            <div class="toggle-container">
                <label class="switch">
                    <input type="checkbox" id="general-knowledge-toggle">
                    <span class="slider round"></span>
                </label>
                <label for="general-knowledge-toggle" id="general-knowledge-label" class="toggle-label">General
                    Knowledge No</label>
            </div>
        </div>
        <div class="chat-window" id="chat-window">
            <div class="chatbot-bubble">
                <p>{{startingMessage}}</p>
            </div>
        </div>

        <div style="display:inline-block; padding: 5px; margin: -13px 20px;">
            <i class='far fa-thumbs-up' style='font-size:21px; cursor:pointer;'></i>
            <i class='far fa-thumbs-down' style='font-size:21px; cursor:pointer; margin-left:5px;'></i>
            <div class="feedback-container">
                <div>
                    <h4 style="display:inline-block;">Why did you choose this rating? </h4>
                    <div style="display:inline-block;">
                        (Optional)
                    </div>
                    <div style="float:right;">
                        <i class="fa-solid fa-xmark" style="font-size:21px; cursor:pointer;"></i>
                    </div>
                    <div>
                        <div style="display:inline-flex;">
                            <button type="button" class="btn btn-outline-secondary">Inhalt sollte vorhanden sein</button>
                            <button type="button" class="btn btn-outline-secondary" style="margin-left:10px">Chatbot Aussage ist falsch</button>
                            <button type="button" class="btn btn-outline-secondary" style="margin-left:10px">Chatbot Aussage ist nicht vollständig</button>
                        </div>                        
                    </div>
                    <div>
                        <input placeholder="Provide additional feedback" type="text" class="form-control" style="margin-top:30px; width:600px; padding:10px; display:inline-block;" />
                        <button class="btn btn-primary" style="display:inline-block; padding:10px; background-color:#201638">Submit</button>
                        <div style="font-size:10px; color:#5a6268; margin-left:5px;">
                            Mit Ihrem Feedback kann der Chatbot lernen und in Zukunft Ihre Anforderungen noch besser erfüllen.
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="chat-input-container">
            {% csrf_token %}
            <input type="text" class="chat-input" placeholder="Send a message" id="chat-input">
            <button class="chat-button">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="none" class="h-4 w-4 m-1 md:m-0"
                    stroke-width="2">
                    <path
                        d="M.5 1.163A1 1 0 0 1 1.97.28l12.868 6.837a1 1 0 0 1 0 1.766L1.969 15.72A1 1 0 0 1 .5 14.836V10.33a1 1 0 0 1 .816-.983L8.5 8 1.316 6.653A1 1 0 0 1 .5 5.67V1.163Z"
                        fill="currentColor"></path>
                </svg>
            </button>
        </div>
            <div class="footer" style="color:#666; margin-top:-5px; text-align:right; font-size:14px; font-weight:500;">
                © by nevolvis, all rights reserved
            </div>
    </div>
    <script>
       $(document).ready(function() {
            const chatInput = $(".chat-input");
            const chatWindow = $(".chat-window");
            const updateButton = $("#update-button");
            const generalKnowledgeToggle = $("#general-knowledge-toggle");
            const generalKnowledgeLabel = $("#general-knowledge-label");
            const chatButton = $(".chat-button");
            const thumbsUp = $(".fa-thumbs-up");
            const thumbsDown = $(".fa-thumbs-down");

            $('.btn-outline-secondary').click(function() {
                // Toggle 'btn-selected' class on and off
                $(this).toggleClass('btn-selected');

                // Optionally, if you want to ensure that only one button can be 'selected' at a time:
                if ($(this).hasClass('btn-selected')) {
                    // Remove 'btn-selected' from other buttons
                    $('.btn-outline-secondary').not(this).removeClass('btn-selected');
                }
            });

            function getCSRFToken() {
                return $('input[name="csrfmiddlewaretoken"]').val();
            }

            function addChatMessage(message, type = 'user') {
                const chatBubble = $('<div>').addClass(type === 'user' ? 'chat-bubble' : 'chatbot-bubble');
                chatBubble.html(`<p>${message}</p>`);
                chatWindow.append(chatBubble);
                chatWindow.scrollTop(chatWindow.prop("scrollHeight"));
            }

            function getResponse(message) {
                const csrftoken = getCSRFToken();
                return $.ajax({
                    url: '',
                    type: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrftoken
                    },
                    data: JSON.stringify({
                        'userMessage': message,
                    }),
                    dataType: 'json',
                    success: function(response) {
                        console.log(response);
                        return response;
                    },
                    error: function(xhr, status, error) {
                        console.error('Error:', error);
                        throw error;  // Rethrow the error so it can be handled by the caller
                    }
                });
            }

            async function sendMessage() {
                const message = chatInput.val().trim();
                if (message) {
                    console.log("1")
                    addChatMessage(message, 'user');
                    chatInput.val("");

                    try {
                        const response = await getResponse(message);
                        // Simulate chatbot response
                        setTimeout(() => {
                            addChatMessage(response["response"], 'chatbot');
                        }, 1000);
                    } catch (error) {
                        console.error('Failed to send message:', error);
                    }
                }
            }

            chatInput.keypress(function(event) {
                if (event.key === "Enter") {
                    event.preventDefault();
                    sendMessage();
                }
            });

            chatButton.click(function() {
                sendMessage();
            });

            updateButton.click(function() {
                console.log("Update Chatbot Contents button clicked");
            });

            thumbsUp.click(function(){
                $(this).toggleClass('selected-icon');
                thumbsDown.removeClass('selected-icon');
                 $(".feedback-container").slideUp();
            });

            $(".fa-xmark").click(function(){
                $(".feedback-container").slideUp();
                thumbsDown.removeClass('selected-icon');
                thumbsUp.removeClass('selected-icon');
            })

            thumbsDown.click(function(){
                $(this).toggleClass('selected-icon');
                thumbsUp.removeClass('selected-icon');
                if ($(".feedback-container").is(":visible")) {
                    $(".feedback-container").slideUp();  // Hides the container with a slide up animation
                } else {
                    $(".feedback-container").slideDown();  // Shows the container with a slide down animation
                }
            });

            generalKnowledgeToggle.change(function() {
                generalKnowledgeLabel.text($(this).is(':checked') ? 'General Knowledge Yes' : 'General Knowledge No');
            });
        });

    </script>
</body>

</html>